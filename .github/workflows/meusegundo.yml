name: Verifica√ß√£o da classe DocumentMINHACLASSE

on:
  pull_request:
    types: [opened, synchronize, reopened]
  push:

jobs:
  check-terms:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout do c√≥digo
        uses: actions/checkout@v4

      - name: Verificar classe DocumentMINHACLASSE
        id: verificar
        run: |
          set -e
          FILES=$(grep -Eril --include="*.java" "class DocumentMINHACLASSE[A-Za-z0-9_]*" . || true)

          if [ -z "$FILES" ]; then
            echo "‚ùå Classe DocumentMINHACLASSE n√£o encontrada."
            echo "status=falha" >> $GITHUB_OUTPUT
            echo "mensagem=Classe DocumentMINHACLASSE n√£o encontrada." >> $GITHUB_OUTPUT
            exit 1
          fi

          echo "Arquivos encontrados:"
          echo "$FILES"

          STATUS="ok"
          MSG=""

          for FILE in $FILES; do
            echo "üîç Verificando arquivo: $FILE"
            
            if grep -q "um dois tr√™s" "$FILE"; then
              if grep -q "cada um no seu quadrado" "$FILE"; then
                echo "‚ùå Erro: Encontrado ambos ('um dois tr√™s' e 'cada um no seu quadrado') em $FILE"
                MSG+="\n- ‚ùå Erro: Encontrado ambos ('um dois tr√™s' e 'cada um no seu quadrado') em \`$FILE\`"
                STATUS="falha"
              else
                echo "‚ö†Ô∏è Aviso: Encontrado 'um dois tr√™s' em $FILE (sem 'cada um no seu quadrado')."
                MSG+="\n- ‚ö†Ô∏è Aviso: Encontrado 'um dois tr√™s' em \`$FILE\` (sem 'cada um no seu quadrado')."
              fi
            else
              echo "‚úî OK: Nenhum termo encontrado em $FILE"
              MSG+="\n- ‚úî OK: Nenhum termo proibido encontrado em \`$FILE\`"
            fi
          done

          {
            echo "arquivos_falha<<EOF"
            echo "$FILES"
            echo "EOF"

            echo "mensagem<<EOF"
            echo -e "$MSG"
            echo "EOF"

            echo "status=$STATUS"
          } >> $GITHUB_OUTPUT


          if [ "$STATUS" = "falha" ]; then
            exit 1
          fi

      # ‚úÖ Comentar automaticamente o resultado no PR
      - name: Comentar resultado no Pull Request
        if: ${{ github.event_name == 'pull_request' }}
        uses: marocchino/sticky-pull-request-comment@v2
        with:
          header: documentminhaclasse-check
          message: |
            ${{ steps.verificar.outputs.status == 'ok' && '‚úÖ **Verifica√ß√£o da classe `DocumentMINHACLASSE` passou com sucesso!** üéâ' || '‚ö†Ô∏è **Falha na verifica√ß√£o da classe `DocumentMINHACLASSE`**' }}

            **Resumo da an√°lise:**
            ${{ steps.verificar.outputs.mensagem }}

            ---
            üß© *Verifica√ß√£o autom√°tica executada via GitHub Actions.*
